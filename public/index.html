<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Gi·∫£i B√†i T·∫≠p C·∫•p 2-3</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="/styles.css" />
    <script src="/main.js"></script>
  </head>
  <body>
    <!-- TOP HEADER -->
    <header class="top-header">
      <div class="header-left">
        <img
          src="/images/bookshelf.jpg"
          alt="Bookshelf"
          class="bookshelf logo"
        />
      </div>

      <nav class="menu-class" aria-label="Menu l·ªõp">
        <!-- Th√™m data-class ƒë·ªÉ x·ª≠ l√Ω click tr·ª±c ti·∫øp -->
        <a href="#" data-class="L·ªõp 6">L·ªõp 6</a>
        <a href="#" data-class="L·ªõp 7">L·ªõp 7</a>
        <a href="#" data-class="L·ªõp 8">L·ªõp 8</a>
        <a href="#" data-class="L·ªõp 9">L·ªõp 9</a>
        <a href="#" data-class="L·ªõp 10">L·ªõp 10</a>
        <a href="#" data-class="L·ªõp 11">L·ªõp 11</a>
        <a href="#" data-class="L·ªõp 12">L·ªõp 12</a>
        <a href="#" data-class="Gi√°o √°n - ƒê·ªÅ thi">Gi√°o √°n - ƒê·ªÅ thi</a>
      </nav>

      <div class="header-right">
        <!-- FORM T√åM KI·∫æM (c·∫£i ti·∫øn) -->
        <form class="search-form" id="searchForm">
          <input
            class="search-input"
            name="q"
            type="search"
            placeholder="T√¨m ki·∫øm m√¥n, t√†i li·ªáu..."
            aria-label="T√¨m ki·∫øm"
          />
          <button class="search-btn" type="submit" aria-label="T√¨m">
            <span class="search-icon">üîç</span>
          </button>
        </form>

        <div class="user-area">
          <img
            src="/images/avatar.png"
            alt="Avatar"
            class="avatar"
            id="avatarBtn"
            title="T√†i kho·∫£n"
          />
          <div class="dropdown" id="userDropdown" aria-hidden="true">
            <div id="userNotLogged">
              <a href="#" class="dropdown-item" id="openLogin">ƒêƒÉng nh·∫≠p</a>
              <a href="#" class="dropdown-item">ƒêƒÉng k√Ω</a>
            </div>
            <div id="userLogged" style="display: none">
              <div class="dropdown-item" id="userNameDisplay"></div>
              <a href="#" class="dropdown-item" id="logoutBtn">ƒêƒÉng xu·∫•t</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- INLINE LOGIN (·∫©n m·∫∑c ƒë·ªãnh) -->
    <section id="inlineLogin" class="inline-login hidden" aria-hidden="true">
      <h2>ƒêƒÉng nh·∫≠p</h2>
      <form id="inlineLoginForm" class="inline-login-form">
        <label
          >Username
          <input type="text" name="username" required />
        </label>
        <label
          >Password
          <input type="password" name="password" required />
        </label>
        <div class="inline-actions">
          <button type="submit" class="btn">ƒêƒÉng nh·∫≠p</button>
          <button type="button" class="btn btn-ghost" id="inlineCancel">
            H·ªßy
          </button>
        </div>
      </form>
    </section>

    <!-- SERVICES -->
    <div class="service-area">
      <div class="service-title">WEB H·ªåC T·∫¨P</div>
      <div class="services">
        <div class="service-box">
          <div class="icon">üìù</div>
          <div class="name">Gi·∫£i b√†i t·∫≠p SGK & SBT</div>
        </div>
        <div class="service-box">
          <div class="icon">üìö</div>
          <div class="name">S√°ch</div>
        </div>
        <div class="service-box">
          <div class="icon">üéì</div>
          <div class="name">Kh√≥a h·ªçc</div>
        </div>
      </div>
    </div>

    <!-- CATEGORY / L·ªöP (v·∫´n gi·ªØ ƒë·ªÉ tham kh·∫£o) -->
    <div class="category-area" id="categoryArea">
      <div class="category-title">Danh m·ª•c gi·∫£i b√†i t·∫≠p v√† so·∫°n b√†i</div>
      <div class="category-intro">
        Click v√†o n√∫t L·ªõp ·ªü menu tr√™n ƒë·ªÉ xem c√°c m√¥n.
      </div>

      <div class="accordion" id="classAccordion">
        <!-- c√°c accordion-item gi·ªØ ƒë·ªÉ hi·ªÉn th·ªã t√≥m t·∫Øt n·∫øu c·∫ßn -->
        <div class="accordion-item">
          <button class="accordion-button" data-class="L·ªõp 6" type="button">
            <span>L·ªõp 6</span><span class="arrow">&#9654;</span>
          </button>
          <div class="accordion-panel">
            <p>N·ªôi dung t√≥m t·∫Øt cho l·ªõp 6...</p>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-button" data-class="L·ªõp 7" type="button">
            <span>L·ªõp 7</span><span class="arrow">&#9654;</span>
          </button>
          <div class="accordion-panel">
            <p>N·ªôi dung t√≥m t·∫Øt cho l·ªõp 7...</p>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-button" data-class="L·ªõp 8" type="button">
            <span>L·ªõp 8</span><span class="arrow">&#9654;</span>
          </button>
          <div class="accordion-panel">
            <p>N·ªôi dung t√≥m t·∫Øt cho l·ªõp 8...</p>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-button" data-class="L·ªõp 9" type="button">
            <span>L·ªõp 9</span><span class="arrow">&#9654;</span>
          </button>
          <div class="accordion-panel">
            <p>N·ªôi dung t√≥m t·∫Øt cho l·ªõp 9...</p>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-button" data-class="L·ªõp 10" type="button">
            <span>L·ªõp 10</span><span class="arrow">&#9654;</span>
          </button>
          <div class="accordion-panel">
            <p>N·ªôi dung t√≥m t·∫Øt cho l·ªõp 10...</p>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-button" data-class="L·ªõp 11" type="button">
            <span>L·ªõp 11</span><span class="arrow">&#9654;</span>
          </button>
          <div class="accordion-panel">
            <p>N·ªôi dung t√≥m t·∫Øt cho l·ªõp 11...</p>
          </div>
        </div>
        <div class="accordion-item">
          <button class="accordion-button" data-class="L·ªõp 12" type="button">
            <span>L·ªõp 12</span><span class="arrow">&#9654;</span>
          </button>
          <div class="accordion-panel">
            <p>N·ªôi dung t√≥m t·∫Øt cho l·ªõp 12...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- SUBJECTS VIEW -->
    <div id="subjectsView" class="subjects-view hidden" aria-hidden="true">
      <div class="subjects-header">
        <button id="backToClasses" class="btn btn-ghost">‚Üê Quay l·∫°i</button>
        <h2 id="subjectsTitle">C√°c m√¥n</h2>
      </div>
      <div id="subjectsGrid" class="subjects-grid"></div>
    </div>

    <script>
      // map l·ªõp -> m√¥n (v√≠ d·ª• tƒ©nh)
      const classSubjects = {
        "L·ªõp 6": [
          "To√°n",
          "Ng·ªØ vƒÉn",
          "Ti·∫øng Anh",
          "Khoa h·ªçc t·ª± nhi√™n",
          "L·ªãch s·ª≠",
          "ƒê·ªãa l√Ω",
        ],
        "L·ªõp 7": [
          "To√°n",
          "Ng·ªØ vƒÉn",
          "Ti·∫øng Anh",
          "V·∫≠t l√Ω c∆° b·∫£n",
          "Sinh h·ªçc",
          "C√¥ng ngh·ªá",
        ],
        "L·ªõp 8": [
          "To√°n",
          "Ng·ªØ vƒÉn",
          "Ti·∫øng Anh",
          "V·∫≠t l√Ω",
          "H√≥a h·ªçc",
          "L·ªãch s·ª≠",
        ],
        "L·ªõp 9": [
          "To√°n",
          "Ng·ªØ vƒÉn",
          "Ti·∫øng Anh",
          "V·∫≠t l√Ω",
          "H√≥a h·ªçc",
          "Sinh h·ªçc",
        ],
        "L·ªõp 10": [
          "To√°n",
          "Ng·ªØ vƒÉn",
          "Ti·∫øng Anh",
          "V·∫≠t l√Ω",
          "H√≥a h·ªçc",
          "Sinh h·ªçc",
        ],
        "L·ªõp 11": [
          "To√°n",
          "Ng·ªØ vƒÉn",
          "Ti·∫øng Anh",
          "V·∫≠t l√Ω",
          "H√≥a h·ªçc",
          "Sinh h·ªçc",
        ],
        "L·ªõp 12": [
          "To√°n",
          "Ng·ªØ vƒÉn",
          "Ti·∫øng Anh",
          "V·∫≠t l√Ω",
          "H√≥a h·ªçc",
          "Sinh h·ªçc",
        ],
        "Gi√°o √°n - ƒê·ªÅ thi": ["ƒê·ªÅ thi THCS", "ƒê·ªÅ thi THPT", "Gi√°o √°n m·∫´u"],
      };

      // H√†m render grid m√¥n
      function showSubjects(className) {
        const subjects = classSubjects[className] || [];
        const grid = document.getElementById("subjectsGrid");
        const title = document.getElementById("subjectsTitle");
        grid.innerHTML = "";
        title.textContent = `C√°c m√¥n c·ªßa ${className}`;
        if (subjects.length === 0) {
          grid.innerHTML = "<p>Ch∆∞a c√≥ m√¥n cho l·ªõp n√†y.</p>";
        } else {
          subjects.forEach((sub) => {
            const card = document.createElement("div");
            card.className = "subject-card";
            card.innerHTML = `
            <div class="subject-name">${sub}</div>
            <button class="btn show-material" data-sub="${sub}">Xem t√†i li·ªáu</button>
          `;
            grid.appendChild(card);
          });
        }
        document.getElementById("categoryArea").classList.add("hidden");
        document.getElementById("subjectsView").classList.remove("hidden");
        document
          .getElementById("subjectsView")
          .setAttribute("aria-hidden", "false");
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      function hideSubjects() {
        document.getElementById("subjectsView").classList.add("hidden");
        document
          .getElementById("subjectsView")
          .setAttribute("aria-hidden", "true");
        document.getElementById("categoryArea").classList.remove("hidden");
      }

      // G·∫Øn event cho menu-class a[data-class] (menu tr√™n c√πng)
      document.querySelectorAll(".menu-class a[data-class]").forEach((a) => {
        a.addEventListener("click", function (e) {
          e.preventDefault();
          const cls = this.dataset.class;
          showSubjects(cls);
        });
      });

      // G·∫Øn event cho accordion-button (n·∫øu mu·ªën click ·ªü ph·∫ßn t√≥m t·∫Øt c≈©ng m·ªü m√¥n)
      document.querySelectorAll(".accordion-button").forEach((btn) => {
        btn.addEventListener("click", function (e) {
          e.preventDefault();
          const cls = this.dataset.class;
          showSubjects(cls);
        });
      });

      document
        .getElementById("backToClasses")
        .addEventListener("click", hideSubjects);

      // x·ª≠ l√Ω click "Xem t√†i li·ªáu" (demo)
      document.addEventListener("click", (e) => {
        if (e.target.matches(".show-material")) {
          alert("B·∫°n ch·ªçn m√¥n: " + e.target.dataset.sub);
        }
      });

      // SEARCH: g·ªçi API /api/search?q=...
      document
        .getElementById("searchForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const q = new FormData(e.target).get("q") || "";
          try {
            const res = await fetch("/api/search?q=" + encodeURIComponent(q));
            const data = await res.json();
            // t·∫°m hi·ªÉn th·ªã k·∫øt qu·∫£ ƒë∆°n gi·∫£n (b·∫°n c√≥ th·ªÉ render chi ti·∫øt)
            alert(
              "K·∫øt qu·∫£: " +
                (data.results && data.results.length
                  ? data.results.map((r) => r.title).join(", ")
                  : "Kh√¥ng c√≥"),
            );
          } catch (err) {
            alert("L·ªói t√¨m ki·∫øm");
          }
        });

      // Inline login: open from dropdown
      document.getElementById("openLogin").addEventListener("click", (e) => {
        e.preventDefault();
        const inline = document.getElementById("inlineLogin");
        inline.classList.remove("hidden");
        inline.scrollIntoView({ behavior: "smooth", block: "center" });
        inline.querySelector('input[name="username"]').focus();
        document.getElementById("userDropdown").classList.remove("open");
      });
      document.getElementById("inlineCancel").addEventListener("click", () => {
        document.getElementById("inlineLogin").classList.add("hidden");
      });

      // Load user (gi·ªØ nguy√™n) - th·ª±c hi·ªán fetch /api/me
      async function loadUser() {
        try {
          const r = await fetch("/api/me");
          const j = await r.json();
          const logged = j.user;
          const userNot = document.getElementById("userNotLogged");
          const userLogged = document.getElementById("userLogged");
          const userNameDisplay = document.getElementById("userNameDisplay");
          if (logged) {
            userNot.style.display = "none";
            userLogged.style.display = "block";
            userNameDisplay.textContent = logged.displayName || logged.username;
          } else {
            userNot.style.display = "block";
            userLogged.style.display = "none";
          }
        } catch (err) {}
      }
      loadUser();
    </script>
  </body>
</html>
