<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>FP — Trang chủ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <header class="top-header">
    <div class="header-left">
      <a href="/"><img src="logo.png" alt="logo" class="logo"></a>
      <div>
        <h1>FP — Hệ thống học tập</h1>
        <div class="tagline small muted">Trang quản lý người dùng & danh sách môn</div>
      </div>
    </div>

    <nav class="menu-class" aria-label="Lớp">
      <a href="#" class="menu-item active">Lớp 6</a>
      <a href="#" class="menu-item">Lớp 7</a>
      <a href="#" class="menu-item">Lớp 8</a>
      <a href="#" class="menu-item">Lớp 9</a>
      <a href="#" class="menu-item">Lớp 10</a>
      <a href="#" class="menu-item">Lớp 11</a>
      <a href="#" class="menu-item">Lớp 12</a>
      <a href="upload-assignments.html" class="menu-item menu-upload" id="link-upload"><i class="fa fa-upload"></i> Tải bài tập</a>
    </nav>

    <div class="header-right">
      <form class="search-form" role="search" onsubmit="return false">
        <input class="search-input" placeholder="Tìm môn, lớp..." />
        <button class="search-btn" aria-label="Search"><i class="fa fa-search"></i></button>
      </form>

      <div class="user-area">
        <img src="avatar.png" alt="avatar" class="avatar" id="avatarBtn">
      </div>
    </div>
  </header>

  <main class="container">
    <section class="card" id="main">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <h2 id="status-title">Bạn chưa đăng nhập</h2>
          <div id="status-desc" class="muted">Bạn có thể đăng nhập hoặc đăng ký để truy cập các tính năng bảo mật.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <a href="login.html" class="btn btn-ghost" id="link-login"><i class="fa fa-right-to-bracket"></i> Đăng nhập</a>
          <a href="register.html" class="btn" id="link-register"><i class="fa fa-user-plus"></i> Đăng ký</a>
          <a href="upload-assignments.html" class="btn btn-ghost" id="btn-upload-quick"><i class="fa fa-upload"></i> Tải bài tập</a>
        </div>
      </div>

      <div id="user-card" class="card hidden" style="margin-top:16px">
        <h3>Thông tin tài khoản</h3>
        <div id="user-info" class="muted"></div>
        <div class="user-actions">
          <button id="btn-logout" class="btn btn-ghost"><i class="fa fa-sign-out-alt"></i> Đăng xuất</button>
          <button id="btn-test" class="btn"><i class="fa fa-lock"></i> Gọi API bảo mật</button>
        </div>
        <div id="api-result" class="api-result"></div>
      </div>

    </section>

    <section class="card subjects-view" id="subjects">
      <h3 class="service-title">Danh sách môn theo nhóm lớp</h3>
      <p class="small muted">Nhấp vào môn để xem mô tả mẫu. Danh sách bao gồm hai nhóm: Lớp 6–9 và Lớp 10–12.</p>

      <div class="grid">
        <div class="grade">
          <h4>Lớp 6 — 9</h4>
          <div class="two-col">
            <div>
              <strong>Lớp 6</strong>
              <ul id="grade-6"></ul>
            </div>
            <div>
              <strong>Lớp 7</strong>
              <ul id="grade-7"></ul>
            </div>
            <div>
              <strong>Lớp 8</strong>
              <ul id="grade-8"></ul>
            </div>
            <div>
              <strong>Lớp 9</strong>
              <ul id="grade-9"></ul>
            </div>
          </div>
        </div>

        <div class="grade">
          <h4>Lớp 10 — 12</h4>
          <div class="two-col">
            <div>
              <strong>Lớp 10</strong>
              <ul id="grade-10"></ul>
            </div>
            <div>
              <strong>Lớp 11</strong>
              <ul id="grade-11"></ul>
            </div>
            <div>
              <strong>Lớp 12</strong>
              <ul id="grade-12"></ul>
            </div>
            <div>
              <strong>Chung</strong>
              <ul id="grade-common"></ul>
            </div>
          </div>
        </div>
      </div>

      <div id="subject-detail" class="subject-detail" style="display:none">
        <h4 id="subject-title"></h4>
        <div id="subject-desc" class="muted"></div>
      </div>
    </section>

    <section class="card" style="margin-top:16px">
      <h3>Ghi chú</h3>
      <ul>
        <li>Đăng ký → đăng nhập → quay về trang chủ để thấy thông tin tài khoản.</li>
        <li>Đây là giao diện demo; bạn có thể kết nối danh sách môn với backend để load từ DB.</li>
      </ul>
    </section>

    <footer class="site-footer">
      <div>© FP — Hệ thống học tập</div>
    </footer>
  </main>

  <script>
    // populate subjects + basic auth UI (giữ tương thích với code cũ)
    const subjectsByGrade = {
      6: ['Toán','Ngữ văn','Tiếng Anh','Khoa học tự nhiên','Lịch sử','Địa lí','Tin học','Công nghệ','GDCD'],
      7: ['Toán','Ngữ văn','Tiếng Anh','Vật lí','Hóa học','Sinh học','Lịch sử','Địa lí','Công nghệ'],
      8: ['Toán','Ngữ văn','Tiếng Anh','Vật lí','Hóa học','Sinh học','Lịch sử','Địa lí','Tin học'],
      9: ['Toán','Ngữ văn','Tiếng Anh','Vật lí','Hóa học','Sinh học','Lịch sử','Địa lí','GDQPAN'],
      10:['Toán (Tự chọn/Chuyên)','Ngữ văn','Tiếng Anh','Vật lí','Hóa học','Sinh học','Tin học','GDCD'],
      11:['Toán','Ngữ văn','Tiếng Anh','Vật lí','Hóa học','Sinh học','Tin học','GDQPAN'],
      12:['Toán','Ngữ văn','Tiếng Anh','Vật lí','Hóa học','Sinh học','Tin học','Lịch sử & Địa lí'],
      common:['Giáo dục công dân','Công nghệ','Khoa học tự nhiên','Giáo dục kinh tế và pháp luật']
    };

    const gradeEls = {
      6: document.getElementById('grade-6'),
      7: document.getElementById('grade-7'),
      8: document.getElementById('grade-8'),
      9: document.getElementById('grade-9'),
      10: document.getElementById('grade-10'),
      11: document.getElementById('grade-11'),
      12: document.getElementById('grade-12'),
      common: document.getElementById('grade-common')
    };

    function createSubjectItem(name){
      const li = document.createElement('li');
      const a = document.createElement('a');
      a.textContent = name;
      a.href = '#';
      a.className = 'subject';
      a.addEventListener('click', (e)=>{ e.preventDefault(); showSubjectDetail(name); });
      li.appendChild(a);
      return li;
    }

    function populateSubjects(){
      for(const g of [6,7,8,9,10,11,12]){
        const c = gradeEls[g]; if(!c) continue; c.innerHTML='';
        subjectsByGrade[g].forEach(s => c.appendChild(createSubjectItem(s)));
      }
      if(gradeEls.common){ gradeEls.common.innerHTML=''; subjectsByGrade.common.forEach(s=>gradeEls.common.appendChild(createSubjectItem(s))); }
    }

    function showSubjectDetail(name){
      document.getElementById('subject-title').textContent = name;
      document.getElementById('subject-desc').textContent = `Mô tả mẫu cho môn "${name}"`;
      document.getElementById('subject-detail').style.display = 'block';
      window.scrollTo({top: document.getElementById('subject-detail').offsetTop - 20, behavior:'smooth'});
    }

    // auth helpers
    function token(){ return localStorage.getItem('token'); }
    async function fetchProfile(){
      const t = token(); if(!t) return;
      try{
        const res = await fetch('/api/auth/me', { headers: { 'Authorization': 'Bearer ' + t }});
        if(!res.ok) return;
        const j = await res.json();
        // show user info
        const uc = document.getElementById('user-card');
        uc.classList.remove('hidden');
        document.getElementById('user-info').innerHTML = `<strong>${j.user.display_name||j.user.username}</strong><div class="muted">role: ${j.user.role}</div>`;
        // hide login/register links
        document.getElementById('link-login').style.display='none';
        document.getElementById('link-register').style.display='none';
      }catch(e){ console.warn(e); }
    }

    document.getElementById('btn-logout')?.addEventListener('click', ()=>{ localStorage.removeItem('token'); location.reload(); });

    // init
    populateSubjects();
    fetchProfile();
  </script>
</body>
</html>